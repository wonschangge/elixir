# 配置 /usr/local/elixir/ 目录的安全设置
<Directory /usr/local/elixir/>
    # 禁用 .htaccess 文件中的所有指令覆盖
    AllowOverride None
    # 拒绝所有用户访问此目录
    Require all denied
    # 允许 wsgi.py 文件被访问
    <FilesMatch "wsgi.py">
        # 允许所有用户访问 wsgi.py 文件
        Require all granted
    </FilesMatch>
</Directory>

# 配置 /usr/local/elixir/static/ 目录的安全设置
<Directory /usr/local/elixir/static/>
    # 禁用 .htaccess 文件中的所有指令覆盖
    AllowOverride None
    # 允许所有用户访问此目录
    Require all granted
</Directory>

# 配置虚拟主机
<VirtualHost *:80>
    # 设置服务器名称为本地 IP 地址
    ServerName MY_LOCAL_IP
    # 设置文档根目录
    DocumentRoot /usr/local/elixir/

    # 设置环境变量 LXR_PROJ_DIR
    SetEnv LXR_PROJ_DIR /srv/elixir-data/
    # 配置 WSGI 守护进程
    # 建议将 processes 值设置为可用核心数
    WSGIDaemonProcess Elixir processes=4 display-name=%{GROUP} home=/usr/local/elixir/ python-home=/usr/local/elixir/venv/

    # 将请求分配给 WSGI 守护进程组
    WSGIProcessGroup Elixir
    # 配置 WSGI 脚本别名，排除静态文件请求
    WSGIScriptAliasMatch "^/(?!static/)" /usr/local/elixir/wsgi.py/$1

    # 允许 URL 中包含编码后的斜杠
    AllowEncodedSlashes On
    # 启用重写引擎
    RewriteEngine on
    # 重定向根路径到指定的 Linux 最新源代码页面
    RewriteRule "^/$" "/linux/latest/source" [R]
</VirtualHost>
